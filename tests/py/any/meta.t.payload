# meta length 1000
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ cmp eq reg 1 0x000003e8 ]

# meta length 22
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ cmp eq reg 1 0x00000016 ]

# meta length != 233
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ cmp neq reg 1 0x000000e9 ]

# meta length 33-45
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0x00000021 0x0000002d ]

# meta length != 33-45
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x00000021 0x0000002d ]

# meta length { 33, 55, 67, 88}
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000021	element 00000037	element 00000043	element 00000058
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta length { 33-55, 67-88}
__set%d test-ip4 7
__set%d test-ip4 0
	element 00000000 flags 1	element 00000021	element 00000038 flags 1	element 00000043	element 00000059 flags 1
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]

# meta length { 33-55, 56-88, 100-120}
__set%d test-ip4 7
__set%d test-ip4 0
	element 00000000 flags 1	element 00000021	element 00000059 flags 1	element 00000064	element 00000079 flags 1
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]

# meta length != { 33, 55, 67, 88}
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000021	element 00000037	element 00000043	element 00000058
ip test-ip4 input
  [ meta load len => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta protocol { ip, arp, ip6, vlan }
__set%d test-ip4 3
__set%d test-ip4 0
	element 0800	element 0806	element 86dd	element 8100
ip test-ip4 input
  [ meta load protocol => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta protocol != {ip, arp, ip6, 8021q}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0800	element 0806	element 86dd	element 8100
ip test-ip4 input
  [ meta load protocol => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta protocol ip
ip test-ip4 input
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x0800 ]

# meta protocol != ip
ip test-ip4 input
  [ meta load protocol => reg 1 ]
  [ cmp neq reg 1 0x0800 ]

# meta l4proto 22
ip test-ip4 input
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x16 ]

# meta l4proto != 233
ip test-ip4 input
  [ meta load l4proto => reg 1 ]
  [ cmp neq reg 1 0xe9 ]

# meta l4proto 33-45
ip test-ip4 input
  [ meta load l4proto => reg 1 ]
  [ range eq reg 1 0x21 0x2d ]

# meta l4proto != 33-45
ip test-ip4 input
  [ meta load l4proto => reg 1 ]
  [ range neq reg 1 0x21 0x2d ]

# meta l4proto { 33, 55, 67, 88}
__set%d test-ip4 3
__set%d test-ip4 0
	element 21	element 37	element 43	element 58
ip test-ip4 input
  [ meta load l4proto => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta l4proto != { 33, 55, 67, 88}
__set%d test-ip4 3
__set%d test-ip4 0
	element 21	element 37	element 43	element 58
ip test-ip4 input
  [ meta load l4proto => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta mark 0x4
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ cmp eq reg 1 0x00000004 ]

# meta mark 0x32
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ cmp eq reg 1 0x00000032 ]

# meta mark and 0x03 == 0x01
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x00000003 ) ^ 0x00000000 ]
  [ cmp eq reg 1 0x00000001 ]

# meta mark and 0x03 != 0x01
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x00000003 ) ^ 0x00000000 ]
  [ cmp neq reg 1 0x00000001 ]

# meta mark 0x10
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ cmp eq reg 1 0x00000010 ]

# meta mark != 0x10
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ cmp neq reg 1 0x00000010 ]

# meta mark 0xffffff00/24
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xffffff00 ) ^ 0x00000000 ]
  [ cmp eq reg 1 0xffffff00 ]

# meta mark or 0x03 == 0x01
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfffffffc ) ^ 0x00000003 ]
  [ cmp eq reg 1 0x00000001 ]

# meta mark or 0x03 != 0x01
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfffffffc ) ^ 0x00000003 ]
  [ cmp neq reg 1 0x00000001 ]

# meta mark xor 0x03 == 0x01
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ cmp eq reg 1 0x00000002 ]

# meta mark xor 0x03 != 0x01
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ cmp neq reg 1 0x00000002 ]

# meta iif "lo" accept
ip test-ip4 input
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ immediate reg 0 accept ]

# meta iif != "lo" accept
ip test-ip4 input
  [ meta load iif => reg 1 ]
  [ cmp neq reg 1 0x00000001 ]
  [ immediate reg 0 accept ]

# meta iifname "dummy0"
ip test-ip4 input
  [ meta load iifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x79300000 0x00000000 0x00000000 ]

# meta iifname != "dummy0"
ip test-ip4 input
  [ meta load iifname => reg 1 ]
  [ cmp neq reg 1 0x64756d6d 0x79300000 0x00000000 0x00000000 ]

# meta iifname {"dummy0", "lo"}
__set%d test-ip4 3
__set%d test-ip4 0
	element 64756d6d 79300000 00000000 00000000	element 6c6f0000 00000000 00000000 00000000
ip test-ip4 input
  [ meta load iifname => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta iifname != {"dummy0", "lo"}
__set%d test-ip4 3
__set%d test-ip4 0
	element 64756d6d 79300000 00000000 00000000	element 6c6f0000 00000000 00000000 00000000
ip test-ip4 input
  [ meta load iifname => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta iifname "dummy*"
ip test-ip4 input
  [ meta load iifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x79 ]

# meta iifname "dummy\*"
ip test-ip4 input
  [ meta load iifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x792a0000 0x00000000 0x00000000 ]

# meta iiftype {ether, ppp, ipip, ipip6, loopback, sit, ipgre}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0001	element 0200	element 0300	element 0301	element 0304	element 0308	element 030a
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta iiftype != {ether, ppp, ipip, ipip6, loopback, sit, ipgre}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0001	element 0200	element 0300	element 0301	element 0304	element 0308	element 030a
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta iiftype != ether
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ cmp neq reg 1 0x0001 ]

# meta iiftype ether
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ cmp eq reg 1 0x0001 ]

# meta iiftype != ppp
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ cmp neq reg 1 0x0200 ]

# meta iiftype ppp
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ cmp eq reg 1 0x0200 ]

# meta oif "lo" accept
ip test-ip4 input
  [ meta load oif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]
  [ immediate reg 0 accept ]

# meta oif != "lo" accept
ip test-ip4 input
  [ meta load oif => reg 1 ]
  [ cmp neq reg 1 0x00000001 ]
  [ immediate reg 0 accept ]

# meta oifname "dummy0"
ip test-ip4 input
  [ meta load oifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x79300000 0x00000000 0x00000000 ]

# meta oifname != "dummy0"
ip test-ip4 input
  [ meta load oifname => reg 1 ]
  [ cmp neq reg 1 0x64756d6d 0x79300000 0x00000000 0x00000000 ]

# meta oifname { "dummy0", "lo"}
__set%d test-ip4 3
__set%d test-ip4 0
	element 64756d6d 79300000 00000000 00000000	element 6c6f0000 00000000 00000000 00000000
ip test-ip4 input
  [ meta load oifname => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta oifname "dummy*"
ip test-ip4 input
  [ meta load oifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x79 ]

# meta oifname "dummy\*"
ip test-ip4 input
  [ meta load oifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x792a0000 0x00000000 0x00000000 ]

# meta oiftype {ether, ppp, ipip, ipip6, loopback, sit, ipgre}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0001	element 0200	element 0300	element 0301	element 0304	element 0308	element 030a
ip test-ip4 input
  [ meta load oiftype => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta oiftype != {ether, ppp, ipip, ipip6, loopback, sit, ipgre}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0001	element 0200	element 0300	element 0301	element 0304	element 0308	element 030a
ip test-ip4 input
  [ meta load oiftype => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta oiftype != ether
ip test-ip4 input
  [ meta load oiftype => reg 1 ]
  [ cmp neq reg 1 0x0001 ]

# meta oiftype ether
ip test-ip4 input
  [ meta load oiftype => reg 1 ]
  [ cmp eq reg 1 0x0001 ]

# meta skuid {"bin", "root", "daemon"} accept
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000001	element 00000000	element 00000002
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ lookup reg 1 set __set%d ]
  [ immediate reg 0 accept ]

# meta skuid != {"bin", "root", "daemon"} accept
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000001	element 00000000	element 00000002
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]
  [ immediate reg 0 accept ]

# meta skuid "root"
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta skuid != "root"
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ cmp neq reg 1 0x00000000 ]

# meta skuid lt 3000 accept
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ cmp lt reg 1 0x00000bb8 ]
  [ immediate reg 0 accept ]

# meta skuid gt 3000 accept
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ cmp gt reg 1 0x00000bb8 ]
  [ immediate reg 0 accept ]

# meta skuid eq 3000 accept
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ cmp eq reg 1 0x00000bb8 ]
  [ immediate reg 0 accept ]

# meta skuid 3001-3005 accept
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0x00000bb9 0x00000bbd ]
  [ immediate reg 0 accept ]

# meta skuid != 2001-2005 accept
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x000007d1 0x000007d5 ]
  [ immediate reg 0 accept ]

# meta skgid {"bin", "root", "daemon"} accept
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000001	element 00000000	element 00000002
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ lookup reg 1 set __set%d ]
  [ immediate reg 0 accept ]

# meta skgid != {"bin", "root", "daemon"} accept
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000001	element 00000000	element 00000002
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]
  [ immediate reg 0 accept ]

# meta skgid "root"
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta skgid != "root"
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ cmp neq reg 1 0x00000000 ]

# meta skgid lt 3000 accept
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ cmp lt reg 1 0x00000bb8 ]
  [ immediate reg 0 accept ]

# meta skgid gt 3000 accept
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ cmp gt reg 1 0x00000bb8 ]
  [ immediate reg 0 accept ]

# meta skgid eq 3000 accept
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ cmp eq reg 1 0x00000bb8 ]
  [ immediate reg 0 accept ]

# meta skgid 2001-2005 accept
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0x000007d1 0x000007d5 ]
  [ immediate reg 0 accept ]

# meta skgid != 2001-2005 accept
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x000007d1 0x000007d5 ]
  [ immediate reg 0 accept ]

# meta mark set 0xffffffc8 xor 0x16
ip test-ip4 input
  [ immediate reg 1 0xffffffde ]
  [ meta set mark with reg 1 ]

# meta mark set 0x16 and 0x16
ip test-ip4 input
  [ immediate reg 1 0x00000016 ]
  [ meta set mark with reg 1 ]

# meta mark set 0xffffffe9 or 0x16
ip test-ip4 input
  [ immediate reg 1 0xffffffff ]
  [ meta set mark with reg 1 ]

# meta mark set 0xffffffde and 0x16
ip test-ip4 input
  [ immediate reg 1 0x00000016 ]
  [ meta set mark with reg 1 ]

# meta mark set 0xf045ffde or 0x10
ip test-ip4 input
  [ immediate reg 1 0xf045ffde ]
  [ meta set mark with reg 1 ]

# meta mark set 0xffffffde or 0x16
ip test-ip4 input
  [ immediate reg 1 0xffffffde ]
  [ meta set mark with reg 1 ]

# meta mark set 0x32 or 0xfffff
ip test-ip4 input
  [ immediate reg 1 0x000fffff ]
  [ meta set mark with reg 1 ]

# meta mark set 0xfffe xor 0x16
ip test-ip4 input
  [ immediate reg 1 0x0000ffe8 ]
  [ meta set mark with reg 1 ]

# meta iif "lo"
ip test-ip4 input
  [ meta load iif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]

# meta oif "lo"
ip test-ip4 input
  [ meta load oif => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]

# meta oifname "dummy2" accept
ip test-ip4 input
  [ meta load oifname => reg 1 ]
  [ cmp eq reg 1 0x64756d6d 0x79320000 0x00000000 0x00000000 ]
  [ immediate reg 0 accept ]

# meta skuid 3000
ip test-ip4 input
  [ meta load skuid => reg 1 ]
  [ cmp eq reg 1 0x00000bb8 ]

# meta skgid 3000
ip test-ip4 input
  [ meta load skgid => reg 1 ]
  [ cmp eq reg 1 0x00000bb8 ]

# meta rtclassid "cosmos"
ip test-ip4 input
  [ meta load rtclassid => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta pkttype broadcast
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ cmp eq reg 1 0x01 ]

# meta pkttype host
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ cmp eq reg 1 0x00 ]

# meta pkttype multicast
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ cmp eq reg 1 0x02 ]

# meta pkttype != broadcast
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ cmp neq reg 1 0x01 ]

# meta pkttype != host
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ cmp neq reg 1 0x00 ]

# meta pkttype != multicast
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ cmp neq reg 1 0x02 ]

# pkttype { broadcast, multicast} accept
__set%d test-ip4 3
__set%d test-ip4 0
	element 01	element 02
ip test-ip4 input
  [ meta load pkttype => reg 1 ]
  [ lookup reg 1 set __set%d ]
  [ immediate reg 0 accept ]

# meta cpu 1
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]

# meta cpu != 1
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ cmp neq reg 1 0x00000001 ]

# meta cpu 1-3
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0x00000001 0x00000003 ]

# meta cpu != 1-2
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x00000001 0x00000002 ]

# meta cpu { 2,3}
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000002	element 00000003
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta cpu != { 2,3}
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000002	element 00000003
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta cpu { 2-3, 5-7}
__set%d test-ip4 7
__set%d test-ip4 0
	element 00000000 flags 1	element 00000002	element 00000004 flags 1	element 00000005	element 00000008 flags 1
ip test-ip4 input
  [ meta load cpu => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]

# meta iifgroup 0
ip test-ip4 input
  [ meta load iifgroup => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta iifgroup != 0
ip test-ip4 input
  [ meta load iifgroup => reg 1 ]
  [ cmp neq reg 1 0x00000000 ]

# meta iifgroup "default"
ip test-ip4 input
  [ meta load iifgroup => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta iifgroup != "default"
ip test-ip4 input
  [ meta load iifgroup => reg 1 ]
  [ cmp neq reg 1 0x00000000 ]

# meta iifgroup { 11,33}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0000000b	element 00000021
ip test-ip4 input
  [ meta load iifgroup => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta oifgroup 0
ip test-ip4 input
  [ meta load oifgroup => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta oifgroup != 0
ip test-ip4 input
  [ meta load oifgroup => reg 1 ]
  [ cmp neq reg 1 0x00000000 ]

# meta oifgroup "default"
ip test-ip4 input
  [ meta load oifgroup => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta oifgroup != "default"
ip test-ip4 input
  [ meta load oifgroup => reg 1 ]
  [ cmp neq reg 1 0x00000000 ]

# meta oifgroup { 11,33}
__set%d test-ip4 3
__set%d test-ip4 0
	element 0000000b	element 00000021
ip test-ip4 input
  [ meta load oifgroup => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta cgroup 1048577
ip test-ip4 input
  [ meta load cgroup => reg 1 ]
  [ cmp eq reg 1 0x00100001 ]

# meta cgroup != 1048577
ip test-ip4 input
  [ meta load cgroup => reg 1 ]
  [ cmp neq reg 1 0x00100001 ]

# meta cgroup { 1048577, 1048578 }
__set%d test-ip4 3
__set%d test-ip4 0
	element 00100001	element 00100002
ip test-ip4 input
  [ meta load cgroup => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta cgroup != { 1048577, 1048578}
__set%d test-ip4 3
__set%d test-ip4 0
	element 00100001	element 00100002
ip test-ip4 input
  [ meta load cgroup => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta cgroup 1048577-1048578
ip test-ip4 input
  [ meta load cgroup => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0x00100001 0x00100002 ]

# meta cgroup != 1048577-1048578
ip test-ip4 input
  [ meta load cgroup => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x00100001 0x00100002 ]

# meta iif . meta oif { "lo" . "lo" }
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000001 . 00000001
ip test-ip4 output
  [ meta load iif => reg 1 ]
  [ meta load oif => reg 9 ]
  [ lookup reg 1 set __set%d ]

# meta iif . meta oif . meta mark { "lo" . "lo" . 0x0000000a }
__set%d test-ip4 3
__set%d test-ip4 0
	element 00000001 . 00000001 . 0000000a
ip test-ip4 output
  [ meta load iif => reg 1 ]
  [ meta load oif => reg 9 ]
  [ meta load mark => reg 10 ]
  [ lookup reg 1 set __set%d ]

# meta iif . meta oif vmap { "lo" . "lo" : drop }
__map%d test-ip4 b
__map%d test-ip4 0
	element 00000001 . 00000001 : drop
ip test-ip4 output
  [ meta load iif => reg 1 ]
  [ meta load oif => reg 9 ]
  [ lookup reg 1 set __map%d dreg 0 ]

# meta random eq 1
ip test-ip4 input
  [ meta load prandom => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]

# meta random gt 1000000
ip test-ip4 input
  [ meta load prandom => reg 1 ]
  [ cmp gt reg 1 0x000f4240 ]

# meta priority root
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0xffffffff ]

# meta priority none
netdev test-netdev ingress
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0x00000000 ]

# meta priority 1:1234
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0x00011234 ]

# meta priority bcad:dadc
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0xbcaddadc ]

# meta priority aabb:0
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0xaabb0000 ]

# meta priority != bcad:dadc
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp neq reg 1 0xbcaddadc ]

# meta priority != aabb:0
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp neq reg 1 0xaabb0000 ]

# meta priority bcad:dada-bcad:dadc
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0xbcaddada 0xbcaddadc ]

# meta priority != bcad:dada-bcad:dadc
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0xbcaddada 0xbcaddadc ]

# meta priority {bcad:dada, bcad:dadc, aaaa:bbbb}
__set%d test-ip4 3
__set%d test-ip4 0
	element bcaddada	element bcaddadc	element aaaabbbb
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta priority set cafe:beef
ip test-ip4 input
  [ immediate reg 1 0xcafebeef ]
  [ meta set priority with reg 1 ]

# meta priority != {bcad:dada, bcad:dadc, aaaa:bbbb}
__set%d test-ip4 3
__set%d test-ip4 0
	element bcaddada	element bcaddadc	element aaaabbbb
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta priority 0x87654321
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0x87654321 ]

# meta priority 2271560481
ip test-ip4 input
  [ meta load priority => reg 1 ]
  [ cmp eq reg 1 0x87654321 ]

# meta length { 33-55, 66-88}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 00000021	element 00000038 flags 1	element 00000042	element 00000059 flags 1
ip test-ip4 input 
  [ meta load len => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]

# meta length != { 33-55, 66-88}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 00000021	element 00000038 flags 1	element 00000042	element 00000059 flags 1
ip test-ip4 input 
  [ meta load len => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta l4proto { 33-55, 66-88}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00 flags 1	element 21	element 38 flags 1	element 42	element 59 flags 1
ip test-ip4 input 
  [ meta load l4proto => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta l4proto != { 33-55, 66-88}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00 flags 1	element 21	element 38 flags 1	element 42	element 59 flags 1
ip test-ip4 input 
  [ meta load l4proto => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta skuid { 2001-2005, 3001-3005} accept
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 000007d1	element 000007d6 flags 1	element 00000bb9	element 00000bbe flags 1
ip test-ip4 input 
  [ meta load skuid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]
  [ immediate reg 0 accept ]

# meta iifgroup {"default", 11}
__set%d test-ip4 3 size 2
__set%d test-ip4 0
	element 00000000	element 0000000b
ip test-ip4 input 
  [ meta load iifgroup => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta iifgroup != {"default", 11}
__set%d test-ip4 3 size 2
__set%d test-ip4 0
	element 00000000	element 0000000b
ip test-ip4 input 
  [ meta load iifgroup => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta iifgroup {11-33, 44-55}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 0000000b	element 00000022 flags 1	element 0000002c	element 00000038 flags 1
ip test-ip4 input 
  [ meta load iifgroup => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]

# meta iifgroup != { 11,33}
__set%d test-ip4 3 size 2
__set%d test-ip4 0
	element 0000000b	element 00000021
ip test-ip4 input 
  [ meta load iifgroup => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta iifgroup != {11-33, 44-55}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 0000000b	element 00000022 flags 1	element 0000002c	element 00000038 flags 1
ip test-ip4 input 
  [ meta load iifgroup => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta oifgroup {"default", 11}
__set%d test-ip4 3 size 2
__set%d test-ip4 0
	element 00000000	element 0000000b
ip test-ip4 input 
  [ meta load oifgroup => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta oifgroup {11-33, 44-55}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 0000000b	element 00000022 flags 1	element 0000002c	element 00000038 flags 1
ip test-ip4 input 
  [ meta load oifgroup => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d ]

# meta oifgroup != { 11,33}
__set%d test-ip4 3 size 2
__set%d test-ip4 0
	element 0000000b	element 00000021
ip test-ip4 input 
  [ meta load oifgroup => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta oifgroup != {11-33, 44-55}
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 0000000b	element 00000022 flags 1	element 0000002c	element 00000038 flags 1
ip test-ip4 input 
  [ meta load oifgroup => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta skuid != { 2001-2005, 3001-3005} accept
__set%d test-ip4 7 size 5
__set%d test-ip4 0
	element 00000000 flags 1	element 000007d1	element 000007d6 flags 1	element 00000bb9	element 00000bbe flags 1
ip test-ip4 input 
  [ meta load skuid => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ lookup reg 1 set __set%d 0x1 ]
  [ immediate reg 0 accept ]

# meta oifgroup != {"default", 11}
__set%d test-ip4 3 size 2
__set%d test-ip4 0
	element 00000000	element 0000000b
ip test-ip4 input 
  [ meta load oifgroup => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# meta time "1970-05-23 21:07:14" drop
ip meta-test input
  [ meta load time => reg 1 ]
  [ cmp eq reg 1 0x002bd503 0x43f05400 ]
  [ immediate reg 0 drop ]

# meta time 12341234 drop
ip meta-test input
  [ meta load time => reg 1 ]
  [ cmp eq reg 1 0x002bd849 0x74a8f400 ]
  [ immediate reg 0 drop ]

# meta time "2019-06-21 17:00:00" drop
ip meta-test input
  [ meta load time => reg 1 ]
  [ cmp eq reg 1 0x15aa3ebc 0x767d6000 ]
  [ immediate reg 0 drop ]

# meta time "2019-07-01 00:00:00" drop
ip meta-test input
  [ meta load time => reg 1 ]
  [ cmp eq reg 1 0x15ad18e0 0xe750c000 ]
  [ immediate reg 0 drop ]

# meta time "2019-07-01 00:01:00" drop
ip meta-test input
  [ meta load time => reg 1 ]
  [ cmp eq reg 1 0x15ad18ee 0xdf981800 ]
  [ immediate reg 0 drop ]

# meta time "2019-07-01 00:00:01" drop
ip meta-test input
  [ meta load time => reg 1 ]
  [ cmp eq reg 1 0x15ad18e1 0x22eb8a00 ]
  [ immediate reg 0 drop ]

# meta time < "2022-07-01 11:00:00" accept
ip test-ip4 input
  [ meta load time => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 8, 8) ]
  [ cmp lt reg 1 0x16fda8f3 0x1977a000 ]
  [ immediate reg 0 accept ]

# meta time > "2022-07-01 11:00:00" accept
ip test-ip4 input
  [ meta load time => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 8, 8) ]
  [ cmp gt reg 1 0x16fda8f3 0x1977a000 ]
  [ immediate reg 0 accept ]

# meta day "Saturday" drop
ip test-ip4 input
  [ meta load day => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ immediate reg 0 drop ]

# meta day 6 drop
ip test-ip4 input
  [ meta load day => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ immediate reg 0 drop ]

# meta hour "17:00" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x0000d2f0 ]
  [ immediate reg 0 drop ]

# meta hour "17:00:00" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x0000d2f0 ]
  [ immediate reg 0 drop ]

# meta hour "17:00:01" drop
ip meta-test input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x0000d2f1 ]
  [ immediate reg 0 drop ]

# meta hour "00:00" drop
ip meta-test input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x00013560 ]
  [ immediate reg 0 drop ]

# meta hour "00:01" drop
ip meta-test input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x0001359c ]
  [ immediate reg 0 drop ]

# meta hour "01:01" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x000143ac ]
  [ immediate reg 0 drop ]

# meta hour "02:02" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x00000078 ]
  [ immediate reg 0 drop ]

# meta hour "03:03" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x00000ec4 ]
  [ immediate reg 0 drop ]

# meta hour "23:59:60" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ cmp eq reg 1 0x00013560 ]
  [ immediate reg 0 drop ]

# meta hour "00:00"-"02:02" drop
  [ meta load hour => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x00000078 0x00013560 ]
  [ immediate reg 0 drop ]

# meta hour "01:01"-"03:03" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x00000ec4 0x000143ac ]
  [ immediate reg 0 drop ]

# meta hour "02:02"-"04:04" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range eq reg 1 0x00000078 0x00001d10 ]
  [ immediate reg 0 drop ]

# meta hour "21:00"-"02:00" drop
ip test-ip4 input
  [ meta load hour => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 4, 4) ]
  [ range neq reg 1 0x00000000 0x00010b30 ]
  [ immediate reg 0 drop ]

# time < "2022-07-01 11:00:00" accept
ip test-ip4 input
  [ meta load time => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 8, 8) ]
  [ cmp lt reg 1 0x16fda8f3 0x1977a000 ]
  [ immediate reg 0 accept ]

# time > "2022-07-01 11:00:00" accept
ip test-ip4 input
  [ meta load time => reg 1 ]
  [ byteorder reg 1 = hton(reg 1, 8, 8) ]
  [ cmp gt reg 1 0x16fda8f3 0x1977a000 ]
  [ immediate reg 0 accept ]

# meta mark set vlan id map { 1 : 0x00000001, 4095 : 0x00004095 }
__map%d test-ip4 b size 2
__map%d test-ip4 0
	element 0001 : 00000001	element 0fff : 00004095
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ cmp eq reg 1 0x0001 ]
  [ payload load 2b @ link header + 12 => reg 1 ]
  [ cmp eq reg 1 0x8100 ]
  [ payload load 2b @ link header + 14 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x0fff ) ^ 0x0000 ]
  [ lookup reg 1 set __map%d dreg 1 ]
  [ meta set mark with reg 1 ]

# meta mark set vlan id map @map1
ip test-ip4 input
  [ meta load iiftype => reg 1 ]
  [ cmp eq reg 1 0x0001 ]
  [ payload load 2b @ link header + 12 => reg 1 ]
  [ cmp eq reg 1 0x8100 ]
  [ payload load 2b @ link header + 14 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x0fff ) ^ 0x0000 ]
  [ lookup reg 1 set map1 dreg 1 ]
  [ meta set mark with reg 1 ]

# meta mark set meta mark | iif | meta cpu
ip test-ip4 input
  [ meta load mark => reg 1 ]
  [ meta load iif => reg 2 ]
  [ bitwise reg 1 = ( reg 1 | reg 2 ) ]
  [ meta load cpu => reg 2 ]
  [ bitwise reg 1 = ( reg 1 | reg 2 ) ]
  [ meta set mark with reg 1 ]
