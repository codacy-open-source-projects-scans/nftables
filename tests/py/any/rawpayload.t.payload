# meta l4proto { tcp, udp, sctp} @th,16,16 { 22, 23, 80 }
__set%d test-inet 3 size 3
__set%d test-inet 0
	element 06	element 11	element 84
__set%d test-inet 3 size 3
__set%d test-inet 0
	element 0016	element 0017	element 0050
inet test-inet input 
  [ meta load l4proto => reg 1 ]
  [ lookup reg 1 set __set%d ]
  [ payload load 2b @ transport header + 2 => reg 1 ]
  [ lookup reg 1 set __set%d ]

# meta l4proto tcp @th,16,16 { 22, 23, 80}
__set%d test-inet 3 size 3
__set%d test-inet 0
	element 0016	element 0017	element 0050
inet test-inet input 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ payload load 2b @ transport header + 2 => reg 1 ]
  [ lookup reg 1 set __set%d ]

# @nh,8,8 0xff
inet test-inet input
  [ payload load 1b @ network header + 1 => reg 1 ]
  [ cmp eq reg 1 0xff ]

# @nh,8,16 0x0
inet test-inet input
  [ payload load 2b @ network header + 1 => reg 1 ]
  [ cmp eq reg 1 0x0000 ]

# @ll,0,1 1
inet test-inet input
  [ payload load 1b @ link header + 0 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x80 ) ^ 0x00 ]
  [ cmp eq reg 1 0x80 ]

# @ll,0,8 & 0x80 == 0x80
inet test-inet input
  [ payload load 1b @ link header + 0 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x80 ) ^ 0x00 ]
  [ cmp eq reg 1 0x80 ]

# @ll,0,128 0xfedcba987654321001234567890abcde
inet test-inet input
  [ payload load 16b @ link header + 0 => reg 1 ]
  [ cmp eq reg 1 0xfedcba98 0x76543210 0x01234567 0x890abcde ]

# meta l4proto 91 @th,400,16 0x0 accept
inet test-inet input
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x5b ]
  [ payload load 2b @ transport header + 50 => reg 1 ]
  [ cmp eq reg 1 0x0000 ]
  [ immediate reg 0 accept ]

# meta l4proto 91 @th,0,16 0x0 accept
inet test-inet input
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x5b ]
  [ payload load 2b @ transport header + 0 => reg 1 ]
  [ cmp eq reg 1 0x0000 ]
  [ immediate reg 0 accept ]

# @ih,32,32 0x14000000
inet test-inet input
  [ payload load 4b @ inner header + 4 => reg 1 ]
  [ cmp eq reg 1 0x14000000 ]

# @ih,58,6 set 0 @ih,86,6 set 0 @ih,170,22 set 0
inet test-inet input
  [ payload load 2b @ inner header + 6 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xffc0 ) ^ 0x0000 ]
  [ payload write reg 1 => 2b @ inner header + 6 csum_type 0 csum_off 0 csum_flags 0x1 ]
  [ payload load 2b @ inner header + 10 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfc0f ) ^ 0x0000 ]
  [ payload write reg 1 => 2b @ inner header + 10 csum_type 0 csum_off 0 csum_flags 0x1 ]
  [ payload load 4b @ inner header + 20 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xffc00000 ) ^ 0x00000000 ]
  [ payload write reg 1 => 4b @ inner header + 20 csum_type 0 csum_off 0 csum_flags 0x1 ]

# @ih,58,6 set 0x1 @ih,86,6 set 0x2 @ih,170,22 set 0x3
inet test-inet input
  [ payload load 2b @ inner header + 6 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xffc0 ) ^ 0x0001 ]
  [ payload write reg 1 => 2b @ inner header + 6 csum_type 0 csum_off 0 csum_flags 0x1 ]
  [ payload load 2b @ inner header + 10 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfc0f ) ^ 0x0020 ]
  [ payload write reg 1 => 2b @ inner header + 10 csum_type 0 csum_off 0 csum_flags 0x1 ]
  [ payload load 4b @ inner header + 20 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xffc00000 ) ^ 0x00000003 ]
  [ payload write reg 1 => 4b @ inner header + 20 csum_type 0 csum_off 0 csum_flags 0x1 ]

# @ih,58,6 0x0 @ih,86,6 0x0 @ih,170,22 0x0
inet test-inet input
  [ payload load 1b @ inner header + 7 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x3f ) ^ 0x00 ]
  [ cmp eq reg 1 0x00 ]
  [ payload load 2b @ inner header + 10 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x03f0 ) ^ 0x0000 ]
  [ cmp eq reg 1 0x0000 ]
  [ payload load 3b @ inner header + 21 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x3fffff ) ^ 0x000000 ]
  [ cmp eq reg 1 0x000000 ]

# @ih,1,2 0x2
inet test-inet input
  [ payload load 1b @ inner header + 0 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x60 ) ^ 0x00 ]
  [ cmp eq reg 1 0x40 ]

# @ih,35,3 0x2
inet test-inet input
  [ payload load 1b @ inner header + 4 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x1c ) ^ 0x00 ]
  [ cmp eq reg 1 0x08 ]
