# frag nexthdr tcp
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 0 => reg 1 ]
  [ cmp eq reg 1 0x06 ]

# frag nexthdr != icmp
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 0 => reg 1 ]
  [ cmp neq reg 1 0x01 ]

# frag nexthdr {esp, ah, comp, udp, udplite, tcp, dccp, sctp}
__set%d test-netdev 3 size 8
__set%d test-netdev 0
	element 32	element 33	element 6c	element 11	element 88	element 06	element 21	element 84
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 0 => reg 1 ]
  [ lookup reg 1 set __set%d ]

# frag nexthdr != {esp, ah, comp, udp, udplite, tcp, dccp, sctp}
__set%d test-netdev 3 size 8
__set%d test-netdev 0
	element 32	element 33	element 6c	element 11	element 88	element 06	element 21	element 84
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 0 => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# frag nexthdr esp
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 0 => reg 1 ]
  [ cmp eq reg 1 0x32 ]

# frag nexthdr ah
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 0 => reg 1 ]
  [ cmp eq reg 1 0x33 ]

# frag reserved 22
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 1 => reg 1 ]
  [ cmp eq reg 1 0x16 ]

# frag reserved != 233
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 1 => reg 1 ]
  [ cmp neq reg 1 0xe9 ]

# frag reserved 33-45
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 1 => reg 1 ]
  [ range eq reg 1 0x21 0x2d ]

# frag reserved != 33-45
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 1 => reg 1 ]
  [ range neq reg 1 0x21 0x2d ]

# frag reserved { 33, 55, 67, 88}
__set%d test-netdev 3 size 4
__set%d test-netdev 0
	element 21	element 37	element 43	element 58
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 1 => reg 1 ]
  [ lookup reg 1 set __set%d ]

# frag reserved != { 33, 55, 67, 88}
__set%d test-netdev 3 size 4
__set%d test-netdev 0
	element 21	element 37	element 43	element 58
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 1 => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]

# frag frag-off 22
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 2b @ 44 + 2 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfff8 ) ^ 0x0000 ]
  [ cmp eq reg 1 0x00b0 ]

# frag frag-off != 233
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 2b @ 44 + 2 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfff8 ) ^ 0x0000 ]
  [ cmp neq reg 1 0x0748 ]

# frag frag-off 33-45
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 2b @ 44 + 2 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfff8 ) ^ 0x0000 ]
  [ range eq reg 1 0x0108 0x0168 ]

# frag frag-off != 33-45
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 2b @ 44 + 2 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfff8 ) ^ 0x0000 ]
  [ range neq reg 1 0x0108 0x0168 ]

# frag frag-off { 33, 55, 67, 88}
__set%d test-netdev 3 size 4
__set%d test-netdev 0
	element 0108	element 01b8	element 0218	element 02c0
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 2b @ 44 + 2 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfff8 ) ^ 0x0000 ]
  [ lookup reg 1 set __set%d ]

# frag frag-off != { 33, 55, 67, 88}
__set%d test-netdev 3 size 4
__set%d test-netdev 0
	element 0108	element 01b8	element 0218	element 02c0
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 2b @ 44 + 2 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0xfff8 ) ^ 0x0000 ]
  [ lookup reg 1 set __set%d 0x1 ]

# frag reserved2 1
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 3 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x06 ) ^ 0x00 ]
  [ cmp eq reg 1 0x02 ]

# frag more-fragments 0
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 3 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x01 ) ^ 0x00 ]
  [ cmp eq reg 1 0x00 ]

# frag more-fragments 1
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 1b @ 44 + 3 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x01 ) ^ 0x00 ]
  [ cmp eq reg 1 0x01 ]

# frag id 1
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ cmp eq reg 1 0x00000001 ]

# frag id 22
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ cmp eq reg 1 0x00000016 ]

# frag id != 33
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ cmp neq reg 1 0x00000021 ]

# frag id 33-45
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ range eq reg 1 0x00000021 0x0000002d ]

# frag id != 33-45
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ range neq reg 1 0x00000021 0x0000002d ]

# frag id { 33, 55, 67, 88}
__set%d test-netdev 3 size 4
__set%d test-netdev 0
	element 00000021	element 00000037	element 00000043	element 00000058
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ lookup reg 1 set __set%d ]

# frag id != { 33, 55, 67, 88}
__set%d test-netdev 3 size 4
__set%d test-netdev 0
	element 00000021	element 00000037	element 00000043	element 00000058
netdev test-netdev ingress
  [ meta load protocol => reg 1 ]
  [ cmp eq reg 1 0x86dd ]
  [ exthdr load ipv6 4b @ 44 + 4 => reg 1 ]
  [ lookup reg 1 set __set%d 0x1 ]
