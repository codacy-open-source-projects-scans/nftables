# meta l4proto 17 tproxy ip to 192.0.2.1
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x11 ]
  [ immediate reg 1 0xc0000201 ]
  [ tproxy ip addr reg 1 ]

# meta l4proto 6 tproxy ip to 192.0.2.1:50080
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ immediate reg 1 0xc0000201 ]
  [ immediate reg 2 0xc3a0 ]
  [ tproxy ip addr reg 1 port reg 2 ]

# meta l4proto 6 tproxy ip6 to [2001:db8::1]
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ immediate reg 1 0x20010db8 0x00000000 0x00000000 0x00000001 ]
  [ tproxy ip6 addr reg 1 ]

# meta l4proto 17 tproxy ip6 to [2001:db8::1]:50080
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x11 ]
  [ immediate reg 1 0x20010db8 0x00000000 0x00000000 0x00000001 ]
  [ immediate reg 2 0xc3a0 ]
  [ tproxy ip6 addr reg 1 port reg 2 ]

# meta l4proto 17 tproxy to :50080
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x11 ]
  [ immediate reg 1 0xc3a0 ]
  [ tproxy port reg 1 ]

# meta l4proto 17 tproxy ip to :50080
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x11 ]
  [ immediate reg 1 0xc3a0 ]
  [ tproxy ip port reg 1 ]

# meta l4proto 17 tproxy ip6 to :50080
inet x y 
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x11 ]
  [ immediate reg 1 0xc3a0 ]
  [ tproxy ip6 port reg 1 ]

# ip daddr 0.0.0.0/0 meta l4proto 6 tproxy ip to :2000
inet x y 
  [ meta load nfproto => reg 1 ]
  [ cmp eq reg 1 0x02 ]
  [ payload load 4b @ network header + 16 => reg 1 ]
  [ bitwise reg 1 = ( reg 1 & 0x00000000 ) ^ 0x00000000 ]
  [ cmp eq reg 1 0x00000000 ]
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ immediate reg 1 0x07d0 ]
  [ tproxy ip port reg 1 ]

# meta l4proto 6 tproxy ip to 127.0.0.1:symhash mod 2 map { 0 : 23, 1 : 42 }
__map%d x b size 2
__map%d x 0
	element 00000000 : 0017	element 00000001 : 002a
inet x y
  [ meta load l4proto => reg 1 ]
  [ cmp eq reg 1 0x06 ]
  [ immediate reg 1 0x7f000001 ]
  [ hash reg 2 = symhash() % mod 2 ]
  [ lookup reg 2 set __map%d dreg 2 ]
  [ tproxy ip addr reg 1 port reg 2 ]
